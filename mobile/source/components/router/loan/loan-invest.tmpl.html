
<div id="loan-invest" class="">

    <nav class="omit-margin container page-nav">
    <div class="row">
        <a class="col-xs-3 back" ng-href="loan/{{loan.id}}"><span class="glyphicon glyphicon-menu-left"></span></a>
        <span class="col-xs-6 title">投标</span>
        <span class="col-xs-3">&nbsp;</a>
    </div>
    </nav>

    <div class="c-list-panel info">
        <div class="item title">{{ loan.title }}</div>

        <div class="item">
            <div class="name">可投金额(元)</div>
            <div class="value">{{ loan.balance | number }}</div>
        </div>

        <div class="item">
            <div class="name">账户余额(元)</div>
            <div class="value">{{ self.user.fund.availableAmount | number }}</div>

            <a class="recharge u-right label label-success"
               ng-href="dashboard/recharge?next={{ self.page_path }}"
               ng-if
            >充值</a>
        </div>
    </div>

    <form class="form-horizontal"
          name="form"
          action="/payment/tender"
          method="post"
          target="_self"
          ng-submit="self.submit($event)"
    >
        <div class="invest c-list-panel">
            <div class="item">
                <label for="invest-amount">投资金额(元)</label>
                <div class="input-wrap">
                    <input name="amount"
                           id="invest-amount"
                           ng-model="store.amount"
                           ng-change="form.amount.$valid && self.fetch_analyse(store.amount)"
                           type="number"
                           class="form-control input-sm"
                           placeholder="{{ loan.raw.loanRequest.investRule.minAmount | number }}元起投，{{ loan.raw.loanRequest.investRule.stepAmount | number }}元递增">
                </div>
            </div>

            <div class="item">
                <div class="name">预计收益(元)</div>
                <div class="value">
                    <span class="text-primary" ng-show="form.amount.$valid">{{ earning | number }}</span>
                </div>
            </div>

            <div class="item" ng-if="coupon_list.length">
                <label for="coupon">使用红包</label>
                <div class="input-wrap">
                    <select name="placementId" class="form-control input-sm"
                            id="coupon"
                            ng-model="store.coupon"
                            ng-options="coupon.display for coupon in coupon_list track by coupon.id"
                    >
                        <option value="">请选择可用的红包</option>
                    </select>
                </div>
            </div>
        </div>

        <p class="container">
            <button type="submit" class="btn btn-theme btn-lg btn-block"
                    ng-if="self.user.has_payment_account"
            >确认投标</button>

            <a href="/payment/account/open"
               class="btn btn-theme btn-lg btn-block"
               target="_self"
               ng-click="self.open_payment_account($event)"
               ng-if="!self.user.has_payment_account"
            >开通托管账户</a>
        </p>

        <div class="container" ng-if="!self.user.has_payment_account">
            <p>为什么开通托管账户？</p>
            <p>所有资金由第三方平台托管，绝不设置资金池。所有投资者都会由第三方支付平台的托管账户，保证资金安全。</p>
        </div>

        <input type="hidden" name="loanId" value="{{ loan.id }}"></input>
    </form>

</div>









<script type="text/ng-template" id="ngt-invest-confirm.tmpl">
    <div class="modal-header">
        <h3 class="modal-title">投标已完成</h3>
    </div>
    <div class="modal-body">
        <button class="btn btn-block btn-success" ng-click="$close('/dashboard')">
            我的账户
        </button>
        <button class="btn btn-block btn-default" ng-click="$dismiss()">
            知道了
        </button>
    </div>
</script>

<script type="text/ng-template" id="ngt-loan-invest-short-of-balance.tmpl">
    <div class="modal-body text-center">
        余额不足，前去充值吗？
    </div>

    <div class="modal-buttons">
        <div class="modal-button" ng-click="$close()">取消</div>
        <div class="modal-button" ng-click="$dismiss('dashboard/recharge')">好</div>
    </div>
</script>

<script type="text/ng-template" id="ngt-loan-invest-alert.tmpl">
    <div class="modal-body text-center">{{ content }}</div>

    <div class="modal-buttons">
        <div class="modal-button" ng-click="$close()">好</div>
    </div>
</script>