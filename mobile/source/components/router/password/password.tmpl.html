
<div id="password">

    <nav class="omit-margin container page-nav">
    <div class="row">
        <a class="col-xs-3 back" href="./"><span class="glyphicon glyphicon-menu-left"></span>首页</a>
        <span class="col-xs-6 title">找回密码</span>
        <span class="col-xs-3">&nbsp;</a>
    </div>
    </nav>

    <param ng-model="msg" ng-init="msg = {
        MOBILE_INVALID: '手机号不正确',
        MOBILE_NOT_EXISTS: '该手机号尚未注册',
        MOBILE_SMS_CAPTCHA_ALREADY_SEND: '验证码已发送',
        MOBILE_CAPTCHA_INVALID: '验证码不正确',
        MOBILE_NOT_MATCHED: '该手机号尚未注册',

        SUCCEED: '新密码设置成功，请妥善保存密码',
        UNKNOWN: '未知错误',
    }">

    <div class="page-content">
        <form class="form form-flatten"
              name="form"
              ng-submit="self.send_password_reset(store)"
              novalidate
        >

            <div class="form-group merge"
                 ng-class="{
                    'has-error': form.mobile.$invalid && form.mobile.$dirty,
                 }"
            >
                <input class="form-control input-target input-lg cell" type="tel"
                       name="mobile"
                       ng-model="store.mobile"
                       ng-pattern="/^1\d{10}$/"
                       maxlength="11"
                       placeholder="手机号码"
                       required
                >

                <div class="help-block"
                     ng-show="form.mobile.$invalid && form.mobile.$dirty"
                >
                    <span ng-show="form.mobile.$error.required">必须填写</span>
                    <span ng-show="form.mobile.$error.pattern">请输入正确的手机号码</span>
                </div>
            </div>

            <div class="form-group merge mobile-captcha"
                 ng-class="{
                    'has-error': form.mobile_captcha.$invalid && form.mobile_captcha.$dirty,
                    init: !self.captcha.has_sent,
                 }"
            >
                <input class="form-control input-target input-lg captcha" type="tel"
                       id="mobile_captcha"
                       name="mobile_captcha"
                       ng-model="store.captcha"
                       pattern="^\d{6}$"
                       autocapitalize="none"
                       autocomplete="off"
                       autocorrect="off"
                       placeholder="请输入短信验证码"
                       maxlength="6"
                       required
                >

                <button class="btn btn-default btn-sm btn-action btn-theme" type="button"
                        ng-click="self.send_mobile_captcha(store.mobile)"
                        ng-disabled="form.mobile.$invalid || self.captcha.buffering"
                >
                    <span class="text">获取验证码</span>
                    <span class="count" ng-show="self.captcha.buffering">
                        {{ self.captcha.count | number: 0 }}
                    </span>
                    <span class="icon" ng-hide="self.captcha.buffering">重发</span>
                </button>

                <div class="help-block"
                     ng-show="form.mobile_captcha.$invalid && form.mobile_captcha.$dirty"
                >
                    <span ng-show="form.mobile_captcha.$error.required">必须填写</span>
                    <span ng-show="form.mobile_captcha.$error.pattern">6位数字</span>
                </div>
            </div>

            <div class="form-group merge"
                 ng-class="{'has-error': form.password.$invalid && form.password.$dirty}"
            >
                <input class="form-control input-target input-lg" type="password"
                       name="password"
                       ng-change="password_start_typing = store.password.length"
                       ng-model="store.password"
                       minlength="6"
                       maxlength="16"
                       placeholder="请输新密码"
                       required
                >
                <div class="help-block"
                      ng-show="form.password.$invalid && form.password.$dirty"
                >
                    <span ng-show="form.password.$error.required">必须填写</span>
                    <span ng-show="form.password.$error.minlength || form.password.$error.maxlength">6-16位</span>
                </div>
            </div>

            <div class="form-group merge"
                 ng-class="{'has-error': form.password_confirm.$invalid && form.password_confirm.$dirty}"
            >
                <input class="form-control input-target input-lg" type="password"
                       name="password_confirm"
                       ng-model="password_confirm"
                       ui-validate=" '$value == store.password' "
                       ui-validate-watch=" 'store.password' "
                       placeholder="请再次输入新密码"
                       maxlength="16"
                       required
                >
                <div class="help-block"
                     ng-show="form.password_confirm.$error.validator && form.password_confirm.$dirty"
                >
                    <span ng-show="form.password_confirm.$error.validator">必须相同</span>
                </div>
            </div>

            <div class="form-group merge" x-gyro-comment>
                <div class="input-group">
                    <input class="form-control input-target input-lg" type="text"
                           name="captcha"
                           ng-model="store.captcha"
                           autocapitalize="none"
                           autocomplete="off"
                           autocorrect="off"
                           placeholder="图形验证码"
                           required
                    >

                    <span class="input-group-btn"
                          ng-init="self.fetch_new_captcha()"
                          ng-click="self.fetch_new_captcha()"
                    >
                        <img ng-src="{{ self.captcha.captcha }}"
                             class="captcha-img"
                             width="70"
                             height="30"
                        >
                    </span>
                </div>
            </div>

            <hr />

            <div class="form-group container">
                <button type="submit" class="btn btn-red btn-block btn-lg"
                        ng-disabled="form.$invalid || self.new_password_sending"
                >重设密码</button>
            </div>
        </form>
    </div>
</div>
